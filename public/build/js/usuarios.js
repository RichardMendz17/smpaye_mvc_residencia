document.addEventListener("DOMContentLoaded",(()=>{function e(e,n,t,o=3e3){const r=document.querySelector(".alerta");r&&r.remove();const a=document.createElement("DIV");a.classList.add("alerta",n),a.classList.add("centrar-texto"),a.innerHTML=e,t.parentElement.insertBefore(a,t.nextElementSibling),setTimeout((()=>{a.remove()}),o)}document.querySelectorAll(".form-eliminar").forEach((e=>{e.addEventListener("submit",(function(n){n.preventDefault();const t=e.closest("tr"),o=t.querySelector(".email")?.textContent||"este usuario",r=t.querySelector(".persona_id")?.textContent||"este usuario",a=t.querySelector(".rol")?.textContent||"";Swal.fire({title:"¿Deseas eliminar este registro?",html:`      \n                    <p><strong>Email:</strong> ${o} </p>\n                    <p><strong>Rol:</strong> ${a}</p>\n                    <p><strong>Matrícula/Número de control:</strong> ${r}</p>`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then((n=>{n.isConfirmed&&e.submit()}))}))})),document.querySelector(".registros").addEventListener("click",(function(n){if(n.target&&n.target.matches("button#cambiar_password")){const t=n.target.closest("tr"),o=t.querySelector(".email")?.textContent||"Este usuario",r=n.target.getAttribute("data-id");console.log("ID:",r),console.log("Email:",o),function(n,t){const o=document.createElement("DIV");o.classList.add("modal"),o.innerHTML=`\n                <form class="formulario">\n                <legend>Cambiar contraseña al usuario con el siguiente correo:</legend>\n                <p class="centrar-texto">${t}</p>\n                <div class="campo">\n                    <div class="input-opciones">\n                        <label>Nueva contraseña</label>\n                        <input \n                            type="password"\n                            name="new_password"\n                            placeholder="Escribe la nueva contraseña"\n                            id="new_password"\n                            autocomplete="off"\n                        />\n                    </div>\n                </div>\n\n                <div class="campo">\n                    <div class="input-opciones">\n                        <label>Confirma nueva contraseña</label>\n                        <input \n                            type="password"\n                            name="new_password_confirm"\n                            placeholder="Confirma la nueva contraseña"\n                            id="new_password_confirm"\n                            autocomplete="off"\n                        />\n                    </div> \n                </div> \n                \n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-asignar-password" \n                        value="Asignar nueva contraseña"\n                    />\n                    <button type="button" class="cerrar-modal">CANCELAR</button>\n                </div>                    \n            `,document.querySelector(".dashboard").appendChild(o),setTimeout((()=>{o.querySelector(".formulario").classList.add("animar")}),10),o.addEventListener("click",(function(t){if(t.target.classList.contains("cerrar-modal")&&function(e){const n=e.querySelector(".formulario");n.classList.remove("animar"),n.classList.add("cerrar"),setTimeout((()=>{e.remove()}),500)}(o),t.target.classList.contains("submit-asignar-password")){t.preventDefault();const o=document.querySelector("#new_password").value,r=document.querySelector("#new_password_confirm").value;if(!o||!r)return void e("Ingrese los datos","error",document.querySelector(".formulario legend"),2e3);if(o!=r)return void e("Las contraseñas no coinciden ","error",document.querySelector(".formulario legend"),2e3);if(o.length<=5)return void e("La contraseña debe de tener un minimo de 6 caracteres ","error",document.querySelector(".formulario legend"),2e3);!async function(n,t){const o=new FormData;o.append("id_usuario",n),o.append("password_nuevo",t);try{const n="/api/usuarios-cambiar-password",t=await fetch(n,{method:"POST",body:o}),r=await t.json();if(console.log(r.mensaje),e(r.mensaje,r.tipo,document.querySelector(".formulario legend"),3e3),"exito"===r.tipo){const e=document.querySelector(".modal");setTimeout((()=>{e.remove()}),2e3)}}catch(e){console.log(e)}}(n,o)}}))}(r,o)}}))}));