!function(){let e=[];!async function(){try{const o=`/api/horario-curso?id=${i()}`,r=await fetch(o),n=await r.json();return e=n.horario,a(),e}catch(e){console.log(e)}}();function a(){const a=document.querySelector("#agregar-horario");0!==e.length?a.innerHTML="&#9998; Editar Horario":a.innerHTML="&#43; Crear Horario"}function o(){const t=document.querySelector(".modal");t&&t.remove();const c=document.createElement("DIV");c.classList.add("modal");const s=e.length>0;c.innerHTML=`\n            <form class="formulario unico-campo ">\n                <legend>${s?"Editar Horario":"Crear Horario"}</legend>      \n                    <div> \n                        <div class="horario-header">\n                            <div class="columna">Día</div>\n                            <div class="columna">Entrada</div>\n                            <div class="columna">Salida</div>\n                        </div>\n                        <div id="campos-dias"></div>\n                    </div>\n                    <div class="asignar-unico-campo">\n                        <div class="opciones-unico-campo">\n                        <input \n                            type="submit" \n                            class="submit-asignar-horario" \n                            value="${s?"Confirmar cambios":"Crear Horario"}"\n                        />\n                        <button type="button" class="cerrar-modal">Cerrar</button>\n                        </div>\n                    </div>                      \n            </form>\n            \n        `,document.querySelector(".dashboard").appendChild(c),r(),setTimeout((()=>{c.querySelector(".formulario").classList.add("animar")}),10),c.addEventListener("click",(function(t){if(t.target.classList.contains("cerrar-modal")&&function(e){const a=e.querySelector(".formulario");a.classList.remove("animar"),a.classList.add("cerrar"),setTimeout((()=>{e.remove()}),500)}(c),t.target.classList.contains("submit-asignar-horario")){if(t.preventDefault(),cambiosHorario=function(){let a=e;const o={guardar:[],eliminar:[]},r=document.querySelector(".modal"),i=document.querySelectorAll(".check-dia");for(const e of i){const i=e.dataset.id,t=e.name,c=t.toLowerCase(),s=document.querySelector(`#entrada-${c}`),d=document.querySelector(`#salida-${c}`),l=a.find((e=>e.dia_semana.toLowerCase()===c));if(e.checked){const e=s.value?`${s.value}:00`:"",a=d.value?`${d.value}:00`:"";if(""===a||""===e)return void n("Las horas no pueden quedar vacíos","error",r.querySelector(".formulario legend"));if(a===e)return void n("La hora de salida y entrada no pueden ser iguales","error",r.querySelector(".formulario legend"));if(a<e)return void n("La hora de salida no puede ser antes de la hora de entrada","error",r.querySelector(".formulario legend"));(!l||l.hora_inicio!==e||l.hora_fin!==a)&&o.guardar.push({id:i??null,dia_semana:t,hora_inicio:e,hora_fin:a})}else i&&o.eliminar.push({id:i,dia_semana:t})}return o}(),0===cambiosHorario.guardar.length&&0===cambiosHorario.eliminar.length)return void n("Sin cambios por aplicar","error",c.querySelector(".formulario legend"));Swal.fire({title:"¿Confirmar horario?",text:"Estas seguro de guardar cambios en el horario?",icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((t=>{t.isConfirmed&&async function(t){const c=t.guardar,s=t.eliminar;try{const t=[];0!==s.length&&t.push(async function(a){const o=new FormData;o.append("eliminarDias",JSON.stringify(a)),o.append("curso_id",i());try{const a="/api/horario-curso-eliminar",r=await fetch(a,{method:"POST",body:o}),n=await r.json();if(n){const a=n.diasEliminados,o=new Set(a.map((e=>e.id)));return console.log("Dias a eliminar",a),e=e.filter((e=>!o.has(e.id))),console.log("Se supone que esto debio de actualizarse",e),e}throw new Error(n.mensaje||"Error al eliminar alumno")}catch(e){n(e,"error",document.querySelector(".modal").querySelector(".formulario legend"))}}(s)),0!==c.length&&t.push(async function(a){const o=new FormData;o.append("guardarDias",JSON.stringify(a)),o.append("curso_id",i()),console.log("Dias que se van a guardar",a);try{const r="/api/horario-curso-agregar",n=await fetch(r,{method:"POST",body:o}),i=await n.json();if("exito"!==i.tipo)throw new Error(i.mensaje||"Error al eliminar alumno");{const o=i.DiasGuardados;e=e.map((e=>{const r=o.find((a=>a.id==e.id));if(r){const o=a.find((e=>e.id==r.id));if(o)return{...e,hora_inicio:o.hora_inicio,hora_fin:o.hora_fin}}return e})),o.forEach((o=>{e.some((e=>e.id==o.id));{const r=a.find((e=>e.dia_semana==o.dia_semana));if(r){const a={id:String(o.id),clase_id:o.clase_id,dia_semana:o.dia_semana,hora_inicio:r.hora_inicio,hora_fin:r.hora_fin};console.log("Nuevo registro de día que no estaba en memoria: ",a),e.push(a)}}}))}}catch(e){n(e,"error",document.querySelector(".modal").querySelector(".formulario legend"))}}(c)),await Promise.all(t).then((()=>{a(),o()})),r();n("Cambios aplicados correctamente","exito",document.querySelector(".modal").querySelector(".formulario legend"))}catch(e){console.error(e);n("Hubo un error al guardar los cambios del horario","error",document.querySelector(".modal").querySelector(".formulario legend"))}}(cambiosHorario)}))}}))}function r(){let a={};a=e;const o=document.getElementById("campos-dias");!function(){const e=document.getElementById("campos-dias");for(;e.firstChild;)e.removeChild(e.firstChild)}(),["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"].forEach((e=>{const r=e.toLowerCase(),n=document.createElement("DIV");n.classList.add("campo"),n.classList.add("campo-dia");const i=document.createElement("LABEL");i.textContent=`${e}`,i.htmlFor=`${e}`;const t=document.createElement("INPUT");t.type="checkbox",t.name=e,t.classList.add("check-dia");const c=document.createElement("INPUT");c.type="time",c.name=`horario[${r}][entrada]`,c.id=`entrada-${r}`,c.disabled=!0;const s=document.createElement("INPUT");s.type="time",s.name=`horario[${r}][salida]`,s.id=`salida-${r}`,s.disabled=!0;const d=a.find((e=>e.dia_semana.toLowerCase()===r));d&&(t.dataset.id=d.id??null,t.checked=!0,c.disabled=!1,s.disabled=!1,c.value=d.hora_inicio.slice(0,5),s.value=d.hora_fin.slice(0,5),c.classList.add("activo-dia"),s.classList.add("activo-dia")),t.addEventListener("change",(()=>{!function(e,a,o){const r=e.checked;a.disabled=!r,o.disabled=!r,a.classList.toggle("activo-dia",r),o.classList.toggle("activo-dia",r)}(t,c,s)})),n.appendChild(i),n.appendChild(t),n.appendChild(c),n.appendChild(s),o.appendChild(n)}))}function n(e,a,o,r=3e3){const n=document.querySelector(".alerta");n&&n.remove();const i=document.createElement("DIV");i.classList.add("alerta",a),i.classList.add("centrar-texto"),i.innerHTML=e,o.parentElement.insertBefore(i,o.nextElementSibling),setTimeout((()=>{i.remove()}),r)}function i(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}document.querySelector(".agregar-horario").addEventListener("click",(function(){o()}))}();