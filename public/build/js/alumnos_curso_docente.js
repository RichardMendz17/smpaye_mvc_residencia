!function(){let e=document.querySelector("#todos"),n=document.querySelector("#inscritos"),o=document.querySelector("#aprobados"),a=document.querySelector("#reprobados"),t=document.querySelector("#retirados");!async function(){try{const e=`/api/alumnos-curso?id=${d()}`,n=await fetch(e),o=await n.json();c=o.alumnos,u(),i()}catch(e){console.log(e)}}();let c=[];aprobados=[],inscritos=[],retirados=[],reprobados=[];document.querySelector("#agregar-horario").addEventListener("click",(function(){mostrarFormularioHorario()}));document.querySelectorAll('#filtros input[type="radio"]').forEach((e=>{e.addEventListener("input",i)}));const r=document.querySelector(".eliminar-curso");function i(){!function(){const e=document.querySelector("#listado-alumnos");if(!e)return void console.error("No se encontró el contenedor listado-alumnos");e.innerHTML=""}();let r=[];e.checked?r=c:n.checked?r=inscritos:o.checked?r=aprobados:a.checked?r=reprobados:t.checked&&(r=retirados);const m=document.querySelector("#listado-alumnos");if(0===r.length){const e=document.createElement("LI");return e.textContent="No hay alumnos...",e.classList.add("no-alumnos"),void m.appendChild(e)}const p=document.createElement("LI");p.classList.add("alumno-header"),p.innerHTML='\n            <div class="columna">N° Control</div>\n            <div class="columna">Nombre del alumno</div>\n            <div class="columna">Carrera</div>\n            <div class="columna">Calificación</div>\n            <div class="columna">Estatus</div>\n            <div class="columna">Opciones</div>\n        ',m.appendChild(p),r.slice().sort(((e,n)=>n.alumno_id-e.alumno_id)).forEach((e=>{const n=document.createElement("LI");n.dataset.alumnoId=e.alumno_id,n.classList.add("alumno","alumno-item");const o=document.createElement("P");o.textContent=`${e.alumno_id}`,o.classList.add("columna","numero-control");const a=document.createElement("P");a.textContent=`${e.alumno_Nombre}`,a.classList.add("columna","nombre-alumno");const t=document.createElement("P");t.textContent=`${e.nombre_Carrera||"Sin carrera"}`,t.classList.add("columna","carrera-alumno");const r=document.createElement("P");r.classList.add("columna","calificacion-alumno");const p=document.createElement("span");p.classList.add("texto-calificacion");const f=document.createTextNode(e.calificacion??"No asignada");r.appendChild(p),r.appendChild(f);const C=document.createElement("DIV");C.classList.add("columna-estatus","estatus");const b=document.createElement("DIV");if(b.classList.add("columna-opciones","opciones"),null===e.calificacion||""===e.calificacion||!1===e.calificacion){const n=document.createElement("BUTTON");n.classList.add("asignar-calificacion-alumno","btn","btn-accion"),n.textContent="Asignar Calificación",n.addEventListener("click",(()=>function(e){const n=document.createElement("DIV");n.classList.add("modal"),n.innerHTML=`\n            <form class="formulario unico-campo">\n                <legend>Asignar Calificacion</legend>\n                <div class="asignar-unico-campo">\n                    <div class="datos-unico-campo">\n                        <p>Número de control: ${e.alumno_id}</p>\n                        <hr>\n                        <p>Nombre del alumno:<br>${e.alumno_Nombre}</p>\n                    </div>\n                    <div class="campo-modal">\n                        <label>Calificación</label>\n                        <input\n                            type="number"\n                            id="alumno-id"\n                            placeholder="Calificacion 0 - 100"\n                            autocomplete="off"\n                        />\n                    </div>\n\n                    <div class="opciones-unico-campo">\n                        <input \n                            type="submit" \n                            class="submit-asignar-calificacion" \n                            value="Asignar Calificacion"\n                        />\n                        <button type="button" class="cerrar-modal">CANCELAR</button>\n                    </div>\n\n                <div class="contenedor-sugerencias-alumnos">\n                    <div id="sugerencias-alumnos" class="sugerencias"></div>\n                </div>\n            </form>\n        `,document.querySelector(".dashboard").appendChild(n),setTimeout((()=>{n.querySelector(".formulario").classList.add("animar")}),10),n.addEventListener("click",(function(o){if(o.target.classList.contains("cerrar-modal")&&s(n),o.target.classList.contains("submit-asignar-calificacion")){o.preventDefault();const a=n.querySelector("#alumno-id").value.trim();if(""===a)return void l("La calificación no puede estar vacía","error",n.querySelector(".formulario legend"));if(isNaN(a))return void l("La calificación debe ser un número","error",n.querySelector(".formulario legend"));const t=Number(a);if(t<0||t>100)return void l("La calificación debe estar entre 0 y 100","error",n.querySelector(".formulario legend"));Swal.fire({title:"¿Confirmar calificación?",text:`Vas a asignar ${t} al alumno con el Número de control ${e.alumno_id}`,icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((o=>{o.isConfirmed&&(!async function(e,n){const o=new FormData;o.append("id",e),o.append("calificacion",n),o.append("cursoUrl",d());try{const a="/api/alumnos-curso-calificar",t=await fetch(a,{method:"POST",body:o}),r=await t.json();if(console.log(r.estatus),!r.resultado)throw new Error(r.mensaje||"Error al asignar calificación al alumno");c=c.map((o=>o.alumno_id==e?{...o,calificacion:n,estatus:r.estatus}:o)),u(),i(),Swal.fire("¡Calificación asignada!",`La calificación ${n} fue registrada correctamente.`,"success")}catch(e){console.error("Error al eliminar alumno:",e),Swal.fire("Error","No se pudo eliminar el alumno: "+e.message,"error")}}(e.alumno_id,t),s(n))}))}}))}({...e}))),b.appendChild(n)}const h=document.createElement("BUTTON");h.classList.add("estatus-alumno","btn","btn-estado",e.estatus.toLowerCase()),h.textContent=e.estatus,C.appendChild(h),n.appendChild(o),n.appendChild(a),n.appendChild(t),n.appendChild(r),n.appendChild(C),n.appendChild(b),m.appendChild(n)}))}function s(e){const n=e.querySelector(".formulario");n.classList.remove("animar"),n.classList.add("cerrar"),setTimeout((()=>{e.remove()}),500)}function l(e,n,o,a=3e3){const t=document.querySelector(".alerta");t&&t.remove();const c=document.createElement("DIV");c.classList.add("alerta",n),c.classList.add("centrar-texto"),c.innerHTML=e,o.parentElement.insertBefore(c,o.nextElementSibling),setTimeout((()=>{c.remove()}),a)}function d(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}function u(){inscritos=c.filter((e=>"inscrito"===e.estatus)),aprobados=c.filter((e=>"aprobado"===e.estatus)),reprobados=c.filter((e=>"reprobado"===e.estatus)),retirados=c.filter((e=>"retirado"===e.estatus)),n.disabled=!inscritos.length,o.disabled=!aprobados.length,a.disabled=!reprobados.length,t.disabled=!retirados.length}r&&r.addEventListener("click",(function(e){e.preventDefault();const n=r.closest(".detalles-curso"),o=n.querySelector(".nombre_docente")?.textContent||"este curso",a=n.querySelector(".nombre_Nivel")?.textContent||"",t=n.querySelector(".periodo")?.textContent||"",c=n.querySelector(".nombre_Aula")?.textContent||"";Swal.fire({title:"¿Desea eliminar este curso?",html:`      \n                <p><strong>Docente:</strong> ${o}</p>\n                <p><strong>Nivel:</strong> ${a}</p>\n                <p><strong>Periodo:</strong> ${t}</p>               \n                <p><strong>Aula:</strong> ${c}</p>`,icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((e=>{if(e.isConfirmed){const e=r.closest("form");e?e.submit():console.error("No se encontró el formulario para enviar.")}}))}))}();