!function(){let e=document.querySelector("#todos"),n=document.querySelector("#inscritos"),o=document.querySelector("#aprobados"),a=document.querySelector("#reprobados"),r=document.querySelector("#retirados");!async function(){try{const e=`/api/alumnos-curso?id=${f()}`,n=await fetch(e),o=await n.json();t=o.alumnos,g(),d()}catch(e){console.log(e)}}();let t=[],c=[];aprobados=[],inscritos=[],retirados=[],reprobados=[];document.querySelector("#agregar-alumnos").addEventListener("click",(function(){!function(){c=[];const e=document.createElement("DIV");e.classList.add("modal"),e.innerHTML='\n            <form class="formulario">\n                <h2 class="lista-seleccionados-titulo">Lista de Seleccionados</h2>\n                <div id="lista-alumnos-seleccionados" class="lista-alumnos"></div>        \n                <legend>\'Añadir nuevo(s) alumno(s)\'</legend>\n                <div class="input-opciones">\n                    <div class="campo-modal">\n                        <label>Número de Control</label>\n                        <input\n                            type="text"\n                            name="alumno-id"\n                            placeholder="Escribe al menos 4 digitos..."\n                            id="alumno-id"\n                            autocomplete="off"\n                        />\n                    </div>\n                    <div class="opciones">\n                        <input \n                            type="submit" \n                            class="submit-nuevo-alumno" \n                            value="Añadir Alumno(s)"\n                        />\n                        <button type="button" class="cerrar-modal">CANCELAR</button>\n                    </div>\n                </div>\n                <div class="contenedor-sugerencias-alumnos">\n                    <div id="sugerencias-alumnos" class="sugerencias"></div>\n                </div>\n            </form>\n        ',document.querySelector(".dashboard").appendChild(e),setTimeout((()=>{e.querySelector(".formulario").classList.add("animar")}),10),e.addEventListener("click",(function(n){n.target.classList.contains("cerrar-modal")&&u(e),n.target.classList.contains("submit-nuevo-alumno")&&(n.preventDefault(),0===c.length?m("Seleccione alumnos","error",document.querySelector(".formulario legend"),1e3):async function(e){const n=new FormData;n.append("curso_id",f()),n.append("alumnos_ids",JSON.stringify(e.map((e=>Number(e.id)))));try{const o="/api/alumnos-agregar",a=await fetch(o,{method:"POST",body:n}),r=await a.json();if(m(r.mensaje,r.tipo,document.querySelector(".formulario legend"),3e3),"exito"===r.tipo){const n=document.querySelector(".modal");setTimeout((()=>{n.remove()}),2e3);const o=e.map((e=>({alumno_Nombre:e.nombre_Alumno+" "+e.apellido_Paterno+" "+e.apellido_Materno,alumno_id:e.id,nombre_Carrera:e.nombre_Carrera||"Sin carrera",referencia:null,fecha_inscripcion:(new Date).toISOString(),calificacion:null,estatus:"inscrito"})));t=[...t,...o],g(),e=[],m("Alumnos agregados correctamente, espere un momento","exito",document.querySelector(".formulario legend"),6e3);document.querySelector("#alumno-id").disabled=!0,d()}}catch(e){console.log(e)}}(c))}));let n;e.querySelector("#alumno-id").addEventListener("input",(e=>{clearTimeout(n),n=setTimeout((()=>{!async function(e){try{if(!e||e.length<3)return[];if(e.length>=3){const n=`/api/alumnos-buscar?numero_control=${encodeURIComponent(e)}`,o=await fetch(n),a=await o.json();alumno_Encontrado=a.alumnosDetalles,0===alumno_Encontrado.length&&(m("No hay coincidencias","error",document.querySelector(".formulario legend")),s()),function(e){const n=document.querySelector("#sugerencias-alumnos");n.innerHTML="",0===e.length&&s();e.forEach((e=>{const o=document.createElement("div");o.classList.add("sugerencia"),o.innerHTML=`\n                <div class="sugerencia-contenido">\n                    <span class="alumno-id">${e.id}</span>\n                    <span class="alumno-nombre">\n                        ${e.nombre_Alumno}\n                        ${e.apellido_Paterno}\n                        ${e.apellido_Materno}\n                    </span>\n                    <span class="alumno-carrera">${e.nombre_Carrera||"Sin carrera"}</span>\n                </div>\n            `,o.addEventListener("click",(()=>{document.querySelector("#alumno-id").value=e.id,s(),function(e){const n=t.some((n=>n.alumno_id===e.id)),o=c.some((n=>n.id===e.id));if(n)return void m(`El alumno con el Número de control ${e.id} ya está en la clase`,"error",document.querySelector(".formulario legend"),3e3);if(o)return void m(`El alumno con el Número de control ${e.id} <br> ya está en la lista de seleccionados`,"error",document.querySelector(".formulario legend"),3e3);c.push(e),console.log("Alumno agregado:",e),p()}(e),document.querySelector("#alumno-id").value=""})),n.appendChild(o)}))}(alumno_Encontrado)}else s()}catch(e){console.error("Error al buscar alumnos:",e)}}(e.target.value)}),300)}))}()}));document.querySelectorAll('#filtros input[type="radio"]').forEach((e=>{e.addEventListener("input",d)}));const i=document.querySelector(".eliminar-curso");i&&i.addEventListener("click",(function(e){e.preventDefault();const n=i.closest(".detalles-curso"),o=n.querySelector(".nombre_docente")?.textContent||"este curso",a=n.querySelector(".nombre_Nivel")?.textContent||"",r=n.querySelector(".periodo")?.textContent||"",t=n.querySelector(".nombre_Aula")?.textContent||"";Swal.fire({title:"¿Desea eliminar este curso?",html:`      \n                <p><strong>Docente:</strong> ${o}</p>\n                <p><strong>Nivel:</strong> ${a}</p>\n                <p><strong>Periodo:</strong> ${r}</p>               \n                <p><strong>Aula:</strong> ${t}</p>`,icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((e=>{if(e.isConfirmed){const e=i.closest("form");e?e.submit():console.error("No se encontró el formulario para enviar.")}}))}));const l=document.querySelectorAll(".estado-curso");function s(){document.querySelector("#sugerencias-alumnos").innerHTML=""}function d(){!function(){const e=document.querySelector("#listado-alumnos");if(!e)return void console.error("No se encontró el contenedor listado-alumnos");e.innerHTML=""}();let c=[];e.checked?c=t:n.checked?c=inscritos:o.checked?c=aprobados:a.checked?c=reprobados:r.checked&&(c=retirados);const i=document.querySelector("#listado-alumnos");if(0===c.length){const e=document.createElement("LI");return e.textContent="No hay alumnos...",e.classList.add("no-alumnos"),void i.appendChild(e)}const l=document.createElement("LI");l.classList.add("alumno-header"),l.innerHTML='\n            <div class="columna">N° Control</div>\n            <div class="columna">Nombre del alumno</div>\n            <div class="columna">Carrera</div>\n            <div class="columna">Referencia</div>\n            <div class="columna">Calificación</div>\n            <div class="columna">Estatus</div>\n            <div class="columna">Opciones</div>\n        ',i.appendChild(l),c.slice().sort(((e,n)=>n.alumno_id-e.alumno_id)).forEach((e=>{const n=document.createElement("LI");n.dataset.alumnoId=e.alumno_id,n.classList.add("alumno","alumno-item");const o=document.createElement("P");o.textContent=`${e.alumno_id}`,o.classList.add("columna","numero-control");const a=document.createElement("P");a.textContent=`${e.alumno_Nombre}`,a.classList.add("columna","nombre-alumno");const r=document.createElement("P");r.textContent=`${e.nombre_Carrera||"Sin carrera"}`,r.classList.add("columna","carrera-alumno");const c=document.createElement("P");c.classList.add("columna","referencia-alumno");const l=document.createElement("span");l.classList.add("texto-refencia"),c.ondblclick=function(){!function(e){const n=document.createElement("DIV");n.classList.add("modal"),n.innerHTML=`\n            <form class="formulario unico-campo">\n                <legend>Asignar Referencia</legend>\n                <div class="asignar-unico-campo">\n                    <div class="datos-unico-campo">\n                        <p>Número de control: ${e.alumno_id}</p>\n                        <hr>\n                        <p>Nombre del alumno:<br>${e.alumno_Nombre}</p>\n                    </div>\n                    <div class="campo-modal">\n                        <label>Referencia</label>\n                        <input\n                            type="number"\n                            id="alumno-referencia"\n                            placeholder="Introduzca los 20 dígitos"\n                            autocomplete="off"\n                        />\n                    </div>\n\n                    <div class="opciones-unico-campo">\n                        <input \n                            type="submit" \n                            class="submit-asignar-referencia" \n                            value="Asignar Referencia"\n                        />\n                        <button type="button" class="cerrar-modal">CANCELAR</button>\n                    </div>\n            </form>\n        `,document.querySelector(".dashboard").appendChild(n),setTimeout((()=>{n.querySelector(".formulario").classList.add("animar")}),10),n.addEventListener("click",(function(o){if(o.target.classList.contains("cerrar-modal")&&u(n),o.target.classList.contains("submit-asignar-referencia")){o.preventDefault();const a=n.querySelector("#alumno-referencia").value.trim();if(""===a)return void m("La Referencia no puede estar vacía","error",n.querySelector(".formulario legend"));if(isNaN(a))return void m("La Referencia debe ser un número","error",n.querySelector(".formulario legend"));if(20!==String(a).length)return void m("La referencia debe de ser de 20 digitos","error",n.querySelector(".formulario legend"));Swal.fire({title:"¿Confirmar referencia?",text:`Vas a asignar ${a} al alumno con el Número de control ${e.alumno_id}`,icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((o=>{o.isConfirmed&&(!async function(e,n){const o=new FormData;o.append("id",e),o.append("referencia",n),o.append("cursoUrl",f());try{const a="/api/alumnos-curso-referencia",r=await fetch(a,{method:"POST",body:o}),c=await r.json();if(console.log(c.referencia),!c.resultado)throw new Error(c.mensaje||"Error al asignar la referencia al alumno");t=t.map((o=>o.alumno_id==e?{...o,referencia:n}:o)),g(),d(),Swal.fire("Referencia asignada!",`La referencia ${n} fue registrada correctamente.`,"success")}catch(e){console.error("Error al asignar referencia al alumno:",e),Swal.fire("Error","No se pudo asignar referencia al alumno: "+e.message,"error")}}(e.alumno_id,a),u(n))}))}}))}({...e})};const s=document.createTextNode(e.referencia??"No asignada");c.appendChild(l),c.appendChild(s);const p=document.createElement("P");p.classList.add("columna","calificacion-alumno");const b=document.createElement("span");b.classList.add("texto-calificacion");const v=document.createTextNode(e.calificacion??"No asignada");p.appendChild(b),p.appendChild(v);const h=document.createElement("DIV");h.classList.add("columna-opciones","opciones");const C=document.createElement("DIV");C.classList.add("columna-estatus","estatus");const y=document.createElement("BUTTON");y.classList.add("asignar-calificacion-alumno","btn","btn-accion"),y.textContent="Asignar Calificación",y.addEventListener("click",(()=>function(e){const n=document.createElement("DIV");n.classList.add("modal"),n.innerHTML=`\n            <form class="formulario unico-campo">\n                <legend>Asignar Calificacion</legend>\n                <div class="asignar-unico-campo">\n                    <div class="datos-unico-campo">\n                        <p>Número de control: ${e.alumno_id}</p>\n                        <hr>\n                        <p>Nombre del alumno:<br>${e.alumno_Nombre}</p>\n                    </div>\n                    <div class="campo-modal">\n                        <label>Calificación</label>\n                        <input\n                            type="number"\n                            id="alumno-id"\n                            placeholder="Calificacion 0 - 100"\n                            autocomplete="off"\n                        />\n                    </div>\n                    <div class="opciones-unico-campo">\n                        <input \n                            type="submit" \n                            class="submit-asignar-calificacion" \n                            value="Asignar Calificacion"\n                        />\n                        <button type="button" class="cerrar-modal">CANCELAR</button>\n                    </div>\n                    <div class="contenedor-sugerencias-alumnos">\n                        <div id="sugerencias-alumnos" class="sugerencias"></div>\n                    </div>\n                </div>                    \n            </form>\n        `,document.querySelector(".dashboard").appendChild(n),setTimeout((()=>{n.querySelector(".formulario").classList.add("animar")}),10),n.addEventListener("click",(function(o){if(o.target.classList.contains("cerrar-modal")&&u(n),o.target.classList.contains("submit-asignar-calificacion")){o.preventDefault();const a=n.querySelector("#alumno-id").value.trim();if(""===a)return void m("La calificación no puede estar vacía","error",n.querySelector(".formulario legend"));if(isNaN(a))return void m("La calificación debe ser un número","error",n.querySelector(".formulario legend"));const r=Number(a);if(r<0||r>100)return void m("La calificación debe estar entre 0 y 100","error",n.querySelector(".formulario legend"));Swal.fire({title:"¿Confirmar calificación?",text:`Vas a asignar ${r} al alumno con el Número de control ${e.alumno_id}`,icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((o=>{o.isConfirmed&&(!async function(e,n){const o=new FormData;o.append("id",e),o.append("calificacion",n),o.append("cursoUrl",f());try{const a="/api/alumnos-curso-calificar",r=await fetch(a,{method:"POST",body:o}),c=await r.json();if(!c.resultado)throw new Error(c.mensaje||"Error al asignar calificación al alumno");t=t.map((o=>o.alumno_id==e?{...o,calificacion:n,estatus:c.estatus}:o)),g(),d(),Swal.fire("¡Calificación asignada!",`La calificación ${n} fue registrada correctamente.`,"success")}catch(e){console.error("Error al eliminar alumno:",e),Swal.fire("Error","No se pudo eliminar el alumno: "+e.message,"error")}}(e.alumno_id,r),u(n))}))}}))}({...e})));const S=document.createElement("BUTTON");S.classList.add("estatus-alumno","btn","btn-estado",e.estatus.toLowerCase()),S.textContent=e.estatus;const L=document.createElement("BUTTON");L.classList.add("eliminar-alumno","btn","btn-peligro"),L.dataset.idTarea=e.alumno_id,L.textContent="Eliminar",L.ondblclick=function(){!function(e){const n=t.find((n=>n.alumno_id==e.alumno_id));if(!n)return void console.error("Alumno no encontrado");Swal.fire({title:"¿Eliminar Alumno?",html:`                    \n            <p><strong>Nombre:</strong> ${e.alumno_Nombre}</p>\n            <p><strong>N° Control:</strong> ${e.alumno_id}</p>\n            <p><strong>Carrera:</strong> ${e.nombre_Carrera}</p>\n        `,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"}).then((n=>{n.isConfirmed&&async function(e){console.log(e);const n=new FormData;n.append("id",e),n.append("cursoUrl",f());try{const o="/api/alumnos-curso-eliminar",a=await fetch(o,{method:"POST",body:n}),r=await a.json();if(!r.resultado)throw new Error(r.mensaje||"Error al eliminar alumno");t=t.filter((n=>n.alumno_id!=e)),g(),d(),Swal.fire("¡Eliminado!","El alumno ha sido eliminado correctamente.","success")}catch(e){console.error("Error al eliminar alumno:",e),Swal.fire("Error","No se pudo eliminar el alumno: "+e.message,"error")}}(e.alumno_id)}))}({...e})},h.appendChild(y),C.appendChild(S),h.appendChild(L),n.appendChild(o),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(p),n.appendChild(C),n.appendChild(h),i.appendChild(n)}))}function u(e){const n=e.querySelector(".formulario");n.classList.remove("animar"),n.classList.add("cerrar"),setTimeout((()=>{e.remove()}),500)}function m(e,n,o,a=3e3){const r=document.querySelector(".alerta");r&&r.remove();const t=document.createElement("DIV");t.classList.add("alerta",n),t.classList.add("centrar-texto"),t.innerHTML=e,o.parentElement.insertBefore(t,o.nextElementSibling),setTimeout((()=>{t.remove()}),a)}function p(){const e=document.querySelector("#lista-alumnos-seleccionados");e.innerHTML="",c.forEach((n=>{const o=document.createElement("div");o.className="alumno-seleccionado",o.innerHTML=`\n                    <span class="alumno-id">${n.id}</span>\n                    <span class="alumno-nombre">\n                        ${n.nombre_Alumno}\n                        ${n.apellido_Paterno}\n                        ${n.apellido_Materno} \n                    </span>\n                    <span class="alumno-carrera">${n.nombre_Carrera||"Sin carrera"}</span>                \n                <button class="btn-eliminar" data-id="${n.id}">×</button>\n            `,o.querySelector(".btn-eliminar").addEventListener("click",(e=>{e.stopPropagation(),function(e){const n=c.findIndex((n=>n.id===e));-1!==n&&(c.splice(n,1),p())}(n.id)})),e.appendChild(o)}))}function f(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}function g(){inscritos=t.filter((e=>"inscrito"===e.estatus)),aprobados=t.filter((e=>"aprobado"===e.estatus)),reprobados=t.filter((e=>"reprobado"===e.estatus)),retirados=t.filter((e=>"retirado"===e.estatus)),n.disabled=!inscritos.length,o.disabled=!aprobados.length,a.disabled=!reprobados.length,r.disabled=!retirados.length}l&&l.forEach((e=>{e.addEventListener("click",(function(n){n.preventDefault();const o=document.querySelector(".estado_actual")?.textContent||"este curso",a=e.value||"este curso";document.querySelector(".estado-hidden").value=a,Swal.fire({title:"¿Desea actualizar el estado del curso este curso?",html:`      \n                        <p><strong>Estado Actual:</strong> ${o}</p>\n                        <p><strong>Nuevo Estado:</strong> ${a}</p>`,icon:"warning",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#0891B2",cancelButtonColor:"#3085d6"}).then((n=>{if(n.isConfirmed){const n=e.closest("form");n?n.submit():console.error("No se encontró el formulario para enviar.")}}))}))}))}();